<!DOCTYPE html>
<html lang="fr" layout:decorate="~{decorators/master}" xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
<link rel="stylesheet" th:href="@{/css/main.css}" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Recherche de Vols</title>
</head>
<body>
    <div th:replace="fragments/header :: header"></div>

<section>

<div class="filters-container">
    <div class="filters-left">
        <h2>Trouvez les meilleurs vols</h2>
        <p>Comparez facilement et partez au meilleur prix.</p>
    </div>

    <form id="sortForm" method="get" th:action="@{/}" class="sort-filters">
        <input type="hidden" name="sortBy" id="sortByInput" value="" />

        <button type="button"
        data-sort="date"
        class="sort-btn"
        th:classappend="${sortBy} == 'date' ? ' active' : ''">
    	Plus récents
		</button>

		<button type="button"
        data-sort="price"
        class="sort-btn"
        th:classappend="${sortBy} == 'price' ? ' active' : ''">
    	Moins cher
		</button>

		<button type="button"
        data-sort="location"
        class="sort-btn"
        th:classappend="${sortBy} == 'location' ? ' active' : ''">
    	Localisation
	</button>
    </form>
</div>



<div class="flights-grid">
    <div class="flight-card" th:each="flight : ${flights}">
        <div class="flight-card-inner">
            <!-- Image -->
            <div class="flight-img">
                <img th:src="${flight.image}" loading="lazy"
                     onerror="this.src='https://ulysse.com/news/wp-content/uploads/2024/12/vol-le-plus-court-au-monde.jpg'" />
            </div>
            <!-- Infos -->
            <div class="flight-details">
                <div class="route">
                    <span class="origin" th:text="${flight.origin.name}"></span>
                    <span class="arrow">→</span>
                    <span class="destination" th:text="${flight.destination.name}"></span>
                </div>
                <div class="date-price">
                    <div class="price" th:attr="data-price=${flight.price}"></div>
                    <a th:href="@{/flight/{id}(id=${flight.id}, sortBy=${sortBy})}">
                        <button type="button">Voir</button>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="pagination">
    <div class="prev">
        <form method="get" th:action="@{/}">
            <input type="hidden" name="sortBy" th:value="${sortBy}" />
            <button type="submit" name="page" th:value="${currentPage - 1}" th:disabled="${currentPage == 0}">⬅ Précédent</button>
        </form>
    </div>
    <div class="page-number"> Page <strong th:text="${currentPage + 1}"></strong> </div>
    <div class="next">
        <form method="get" th:action="@{/}" style="width:100%; display:flex; justify-content:flex-end;">
            <input type="hidden" name="sortBy" th:value="${sortBy}" />
            <button type="submit" name="page" th:value="${currentPage + 1}">Suivant ➡</button>
        </form>
    </div>
</div>
</section>

    <div th:replace="fragments/footer :: footer"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const sortForm = document.getElementById("sortForm");
    const sortInput = document.getElementById("sortByInput");
    const buttons = document.querySelectorAll(".sort-btn");

    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            // Mettre la valeur dans l'input hidden
            sortInput.value = btn.dataset.sort;

            // Activer ce bouton et désactiver les autres
            buttons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            // Soumettre le formulaire
            sortForm.submit();
        });
    });
});
</script>

</body>
</html>
